# Bonnes pratiques {.backgroundTitre}

## Cerise, un espace partagé

Comme tout espace partagé et mutualisé, il convient d'être économe en ressources sur Cerise.  

Le DEMESIS a principalement 2 métriques en tête :  

- La consommation de mémoire vive (RAM) : utile pour stocker les données en cours de traitement dans les sessions R.  
- La consommation de CPU (precesseur) : reflète l'intensité des calculs demandés par une session R.

## Gestion des ressources par les utilisateurs (1/2)

Voici quelques conseils pour limiter la consommation de mémoire sous Cerise :  

- **Désactiver la sauvegarde automatique des éléments de session**  

![](img/sauv_RData.png){fig-align="center"}

## Gestion des ressources par les utilisateurs (2/2)

- **Nettoyer régulièrement sa mémoire vive**  

Utiliser la fonction `gc()` pour libérer la mémoire occcupée inutilement par votre session.  
Ou via l'interface de RStudio :  

![](img/liberer_memoire.png){fig-align="center"}

Voir [cette page d'utilitr](https://book.utilitr.org/01_R_Insee/Fiche_utiliser_ressources.html) pour en savoir plus.
    
- **Pour les données volumineuses, privilégier le format de fichier Parquet**  
Voir [ici](https://ssm-agriculture.github.io/formation-R-perf-06-parquet/) pour en savoir plus et/ou vous inscrire aux annonces de formation du BQIS.

## Gestion des sessions (1/N)

- Quand vous vous connectez sur Cerise via l'adresse fournie - **si vous n'avez qu'une session d'ouverte** - Cerise vous place directement dedans (vous arrivez donc dans l'interface RStudio).

- **A partir de 2 sessions ouvertes**, lorsque vous vous connectez à Cerise, vous allez arriver sur l'écran de gestion des sessions :  

![](img/home_sessions.png){fig-align="center"}

## Gestion des sessions (2/N)

- Dans la colonne de gauche de l'écran des sessions, vous trouverez vos sessions ouvertes.  
- Dans la colonne de droite de l'écran des sessions, vous trouvez les différents projets que vous récemment utilisés.  

IMPORTANT : il est important de veiller à limiter votre nombre de sessions actives (maximum 5 !) au risque de ne plus pouvoir accéder à Cerise par la suite.

## Chargement/Téléchargement de fichiers Cerise (1/2)

- Pour **charger** vers Cerise des fichiers depuis votre poste en local :  

Cliquer sur le bouton "upload" dans l'onglet "Files"  

![](img/charger_cerise.png){fig-align="center"}

- Pour **télécharger** depuis Cerise vers votre poste en local :  

Cliquer sur la roue crantée dans l'onglet "Files"

![](img/telecharger_cerise.png){fig-align="center"}

## Chargement/Téléchargement de fichiers Cerise (2/2)

- Si vous souhaitez **charger** plusieurs fichiers en même temps sous Cerise, faire un fichier ZIP. Son contenu sera ensuite automatiquement dézippé sous Cerise.  

- Si vous souhaitez **télécharger** plusieurs fichiers depuis Cerise, RStudio Server va automatiquement les joindre dans un fichier ZIP sur votre poste en local.  